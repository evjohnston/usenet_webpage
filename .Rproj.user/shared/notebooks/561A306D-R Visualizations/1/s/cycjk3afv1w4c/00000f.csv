"0","# Step 1: Group by newsgroup and calculate required statistics, including comment relevancy"
"0","keywords_summary_df <- filtered_comments %>%"
"0","  group_by(newsgroup) %>%"
"0","  summarize("
"0","    Unique_Authors = n_distinct(Author),"
"0","    Comments_with_Keywords = sum(Relevancy > 0),"
"0","    Conversations_Mentioned_In = n_distinct(Thread.ID),"
"0","    Total_Comments_In_Threads = n(),"
"0","    Percent_Total_Comments_w_Keyword = (Comments_with_Keywords / Total_Comments_In_Threads) * 100,"
"0","    Average_Relevancy_Score = mean(Relevancy, na.rm = TRUE)"
"0","  )"
"0",""
"0","# Step 2: Calculate thread relevancy averages for filtered threads"
"0","threads_summary_df_grouped <- filtered_threads %>%"
"0","  group_by(newsgroup) %>%"
"0","  summarize(Average_Thread_Relevancy = mean(Thread_Relevancy, na.rm = TRUE))"
"0",""
"0","# Step 3: Combine comment and thread summaries"
"0","keywords_summary_df <- keywords_summary_df %>%"
"0","  left_join(threads_summary_df_grouped, by = ""newsgroup"")"
"0",""
"0","total_unique_authors <- n_distinct(filtered_comments$Author)"
"0",""
"0","# Step 4: Add a totals row"
"0","totals <- keywords_summary_df %>%"
"0","  summarize("
"0","    newsgroup = ""Total"","
"0","    Comments_with_Keywords = sum(Comments_with_Keywords),"
"0","    Conversations_Mentioned_In = sum(Conversations_Mentioned_In),"
"0","    Total_Comments_In_Threads = sum(Total_Comments_In_Threads),"
"0","    Unique_Authors = total_unique_authors,"
"0","    Percent_Total_Comments_w_Keyword = (Comments_with_Keywords / Total_Comments_In_Threads) * 100,"
"0","    Average_Relevancy_Score = mean(Average_Relevancy_Score, na.rm = TRUE),"
"0","    Average_Thread_Relevancy = mean(Average_Thread_Relevancy, na.rm = TRUE)"
"0","  )"
"0",""
"0","# Step 5: Combine the summary with the totals row"
"0","keywords_summary_df <- bind_rows(keywords_summary_df, totals)"
"0",""
"0","# Correctly construct the output file path"
"0","output_file_path <- file.path(output_directory, ""Images and Tables/Images"", ""table_descriptive_statistics_aids_relevancy_filtered.html"")"
"0",""
"0","# Ensure the directory exists"
"0","dir.create(dirname(output_file_path), recursive = TRUE, showWarnings = FALSE)"
"0",""
"0","# Use the constructed path for saving the file"
"0","tab_df(keywords_summary_df, file = output_file_path)"
