"0","library(tidyverse)"
"0","library(lubridate)"
"0","library(ggplot2)"
"0","library(scales)"
"2","
Attaching package: â€˜scalesâ€™

"
"2","The following object is masked from â€˜package:purrrâ€™:

    discard

"
"2","The following object is masked from â€˜package:readrâ€™:

    col_factor

"
"0","library(topicmodels)"
"0",""
"0","# Function to get topic distributions for a set of documents"
"0","get_topic_distribution <- function(lda_model, dtm) {"
"0","  topic_dist <- posterior(lda_model)$topics"
"0","  colnames(topic_dist) <- paste0(""Topic_"", 1:ncol(topic_dist))"
"0","  cbind(data.frame(Document = rownames(dtm)), as.data.frame(topic_dist))"
"0","}"
"0",""
"0","# Get topic distributions for all documents and influential authors' documents"
"0","all_topic_dist <- get_topic_distribution(lda_model, dtm)"
"0","influential_topic_dist <- get_topic_distribution(influential_lda, influential_dtm)"
"0",""
"0","# Add date and author information"
"0","all_topic_dist$Date <- filtered_comments$Date[match(all_topic_dist$Document, rownames(dtm))]"
"0","all_topic_dist$Influential <- FALSE"
"0",""
"0","influential_topic_dist$Date <- top_authors_comments$Date[match(influential_topic_dist$Document, rownames(influential_dtm))]"
"0","influential_topic_dist$Influential <- TRUE"
"0",""
"0","# Combine datasets"
"0","combined_topic_dist <- rbind(all_topic_dist, influential_topic_dist)"
"0",""
"0","# Calculate monthly topic prevalence"
"0","monthly_topic_prevalence <- combined_topic_dist %>%"
"0","  mutate(Month = floor_date(Date, ""month"")) %>%"
"0","  group_by(Month, Influential) %>%"
"0","  summarise(across(starts_with(""Topic_""), mean)) %>%"
"0","  pivot_longer(cols = starts_with(""Topic_""), names_to = ""Topic"", values_to = ""Prevalence"")"
"1","[38;5;232m`summarise()` has grouped output by 'Month'. You can override using the `.groups` argument.[39m
"
"0","# Create a custom labeler for facet labels"
"0","facet_labels <- c(`FALSE` = ""All Authors"", `TRUE` = ""Influential Authors"")"
"0",""
"0","# Create the line plot for topic prevalence over time with better scaling"
"0","line_plot <- ggplot(monthly_topic_prevalence, aes(x = Month, y = Prevalence, color = Topic, group = Topic)) +"
"0","  geom_line(size = 1.5) +  # Increase line size for better visibility"
"0","  facet_wrap(~Influential, scales = ""free_y"", ncol = 1, labeller = labeller(Influential = facet_labels)) +  # Use labeller to rename facets"
"0","  scale_color_brewer(palette = ""Dark2"") +  # Use a palette with more distinct colors"
"0","  labs(title = ""Topic Prevalence Over Time: Influential Authors vs Overall Discussion"","
"0","       x = ""Date"","
"0","       y = ""Topic Prevalence"","
"0","       color = ""Topic"") +"
"0","  theme_bw() +"
"0","  theme(legend.position = ""bottom"","
"0","        axis.text.x = element_text(angle = 45, hjust = 1)) +  # Rotate x-axis labels for better readability"
"0","  scale_x_date(date_breaks = ""6 months"", date_labels = ""%b %Y"") +"
"0","  scale_y_continuous(labels = scales::percent_format(), limits = c(0.155, 0.1825))  # Zoom in on relevant y-axis range"
"0",""
"0","# Print the plot"
"0","print(line_plot)"
