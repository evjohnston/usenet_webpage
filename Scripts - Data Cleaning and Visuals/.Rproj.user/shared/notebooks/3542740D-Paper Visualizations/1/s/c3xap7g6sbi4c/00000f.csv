"0","library(ggforce)"
"0","library(ggrepel)"
"0","library(ggplot2)"
"0","library(igraph)"
"0",""
"0","# Step 1: Calculate Term Frequencies and Filter for Top Terms"
"0","co_occurrence <- crossprod(as.matrix(dtm)) # Create co-occurrence matrix"
"0","# Set a threshold to filter less relevant terms based on frequency"
"0","term_frequency <- rowSums(co_occurrence) # Calculate term frequency"
"0","threshold <- quantile(term_frequency, 0.75) # Set threshold for top 25% most frequent terms"
"0","filtered_terms <- which(term_frequency > threshold)"
"0","filtered_co_occurrence <- co_occurrence[filtered_terms, filtered_terms]"
"0",""
"0","# Step 2: Create a Graph Object with Filtered Terms"
"0","graph <- graph_from_adjacency_matrix(filtered_co_occurrence, weighted = TRUE, mode = ""undirected"", diag = FALSE)"
"0",""
"0","# Step 3: Simplify the Graph to Avoid Self-Loops and Redundant Edges"
"0","graph <- simplify(graph)"
"0",""
"0","# Step 4: Assign Topics to Terms Based on the LDA Model"
"0","terms <- rownames(filtered_co_occurrence) # Extract terms from the filtered co-occurrence matrix"
"0","term_topic_probs <- posterior(lda_model)$terms[, terms] # Extract term-topic probabilities for the filtered terms"
"0","term_topic_assignment <- apply(term_topic_probs, 2, which.max) # Assign each term to the topic with the highest probability"
"0",""
"0","# Create a data frame mapping terms to topics"
"0","term_topic_df <- data.frame(term = terms, topic = factor(term_topic_assignment))"
"0",""
"0","# Increase the repulsion in the layout algorithm"
"0","set.seed(123)  # For reproducibility"
"0","graph_layout <- create_layout(graph, layout = layout_with_fr(graph, niter = 5000, area = vcount(graph)^3, repulserad = vcount(graph)^3))"
"2","Warning in layout_with_fr(graph, niter = 5000, area = vcount(graph)^3, repulserad = vcount(graph)^3) :"
"2","
 "
"2"," Argument `area' is deprecated and has no effect
"
"2","Warning in layout_with_fr(graph, niter = 5000, area = vcount(graph)^3, repulserad = vcount(graph)^3) :"
"2","
 "
"2"," Argument `repulserad' is deprecated and has no effect
"
"0","# Normalize the layout to ensure it fits within the plot"
"0","graph_layout$x <- scale(graph_layout$x, center = TRUE, scale = TRUE) * 4  # Increase spread"
"0","graph_layout$y <- scale(graph_layout$y, center = TRUE, scale = TRUE) * 4  # Increase spread"
"0",""
"0","# Create intuitive topic names"
"0","topic_names <- c(""Medical Testing"", ""Personal Experience"", ""Disease Research"", ""Sexual Orientation"", ""Social Discussion"")"
"0","term_topic_df$topic_name <- topic_names[term_topic_df$topic]"
"0",""
"0","# Create the improved plot"
"0","co_occurrence_plot <- ggplot(graph_layout, aes(x = x, y = y)) +"
"0","  geom_edge_link(aes(edge_alpha = weight), edge_width = 0.3, color = ""gray70"", alpha = 0.3) +"
"0","  geom_node_point(aes(size = log1p(term_frequency[filtered_terms]), color = term_topic_df$topic_name), show.legend = TRUE, alpha = 0.8) +"
"0","  geom_text_repel(aes(label = name), "
"0","                  max.overlaps = 20,"
"0","                  force = 5,"
"0","                  point.padding = 0.5,"
"0","                  segment.color = ""gray50"","
"0","                  min.segment.length = 0,"
"0","                  box.padding = 0.5,"
"0","                  segment.size = 0.2,"
"0","                  size = 3) +"
"0","  geom_mark_hull(aes(group = term_topic_df$topic_name, fill = term_topic_df$topic_name), "
"0","                 alpha = 0.1, show.legend = FALSE) +"
"0","  scale_size(range = c(2, 10), name = ""Term Frequency"") +"
"0","  scale_color_brewer(palette = ""Set1"", name = ""Topic"") +"
"0","  scale_fill_brewer(palette = ""Set1"") +"
"0","  coord_cartesian(xlim = c(-5, 5), ylim = c(-5, 5)) +"
"0","  theme_void(base_size = 14) +"
"0","  theme("
"0","    aspect.ratio = 1,"
"0","    legend.position = ""right"","
"0","    legend.box = ""vertical"","
"0","    plot.title = element_text(hjust = 0.5, size = 16, face = ""bold""),"
"0","    plot.margin = margin(20, 20, 20, 20)"
"0","  ) +"
"0","  labs(title = ""Co-occurrence Network of Key Themes in AIDS Discussion"","
"0","       caption = ""Node size represents term frequency. Colors indicate topics identified by LDA."")"
"0",""
"0","# Display the plot"
"0","print(co_occurrence_plot)"
