"0","# List of refined keywords and phrases (broad keywords removed)"
"0","keywords <- c(""aids"", ""htlv"", ""hiv"", ""acquired immune deficiency syndrome"", ""human immunodeficiency virus"","
"0","              ""gay plague"", ""gay cancer"", ""kaposi's sarcoma"", ""pneumocystis pneumonia"","
"0","              ""homosexual disease"", ""gay disease"", ""gay fear"", ""fear of gay"", ""fear of homosexual"","
"0","              ""sexual orientation disease"", ""virus"", ""sex"", ""promiscuity"", ""patients"")"
"0",""
"0","# Function to calculate relevancy score"
"0","calculate_relevancy <- function(text) {"
"0","  # Convert text to lowercase"
"0","  text <- tolower(text)"
"0","  # Check for the presence of each keyword"
"0","  keyword_matches <- sapply(keywords, function(keyword) grepl(keyword, text))"
"0","  # Calculate relevancy score as the number of keywords present"
"0","  relevancy_score <- sum(keyword_matches)"
"0","  return(relevancy_score)"
"0","}"
"0",""
"0","# Step 1: Identify threads with at least one comment containing a keyword"
"0","all_comments_aids <- all_comments %>%"
"0","  rowwise() %>%"
"0","  mutate(Contains_Keyword = any(sapply(keywords, function(keyword) grepl(keyword, tolower(Full.Text)))))"
"0",""
"0","# Filter threads containing at least one keyword"
"0","all_threads_aids <- all_comments_aids %>%"
"0","  filter(Contains_Keyword) %>%"
"0","  distinct(Thread.ID)"
"0",""
"0","# Step 2: Fetch all comments from threads with at least one keyword-containing comment"
"0","comments_in_keyword_threads <- all_comments %>%"
"0","  filter(Thread.ID %in% all_threads_aids$Thread.ID)"
"0",""
"0","# Step 3: Calculate relevancy score for each comment and add it to the dataframe"
"0","comments_in_keyword_threads <- comments_in_keyword_threads %>%"
"0","  rowwise() %>%"
"0","  mutate(Relevancy = calculate_relevancy(Full.Text))"
"0",""
"0","# Save the comments dataframe to CSV"
"0","write.csv(comments_in_keyword_threads, file.path(comments_directory, ""aids_related_comments_82TO86.csv""), row.names = FALSE)"
"0",""
"0","# Step 4: Calculate the average relevancy score for each thread"
"0","thread_relevancy_scores <- comments_in_keyword_threads %>%"
"0","  group_by(Thread.ID) %>%"
"0","  summarize(Thread_Relevancy = mean(Relevancy, na.rm = TRUE))"
"0",""
"0","# Merge thread relevancy scores with the original all_threads dataframe and filter to keep only relevant threads"
"0","threads_summary_df <- all_threads %>%"
"0","  filter(Unique_ThreadID %in% all_threads_aids$Thread.ID) %>%"
"0","  left_join(thread_relevancy_scores, by = c(""Unique_ThreadID"" = ""Thread.ID""))"
"0",""
"0","# Save the threads dataframe to CSV"
"0","write.csv(threads_summary_df, file.path(threads_directory, ""aids_related_threads_82TO86.csv""), row.names = FALSE)"
