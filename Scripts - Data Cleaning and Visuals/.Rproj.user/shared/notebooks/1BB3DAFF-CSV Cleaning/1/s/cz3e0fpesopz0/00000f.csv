"0","# Step 5: Group by newsgroup and calculate required statistics, including thread relevancy"
"0","keywords_summary_df <- comments_in_keyword_threads %>%"
"0","  group_by(newsgroup) %>%"
"0","  summarize("
"0","    Unique_Authors = n_distinct(Author),"
"0","    Comments_with_Keywords = sum(Relevancy > 0),"
"0","    Conversations_Mentioned_In = n_distinct(Thread.ID),"
"0","    Total_Comments_In_Threads = n(),"
"0","    Percent_Total_Comments_w_Keyword = (Comments_with_Keywords / Total_Comments_In_Threads) * 100,"
"0","    Average_Relevancy_Score = mean(Relevancy, na.rm = TRUE)"
"0","  )"
"0",""
"0","# Merge thread relevancy averages back to the summary dataframe"
"0","threads_summary_df_grouped <- threads_summary_df %>%"
"0","  group_by(newsgroup) %>%"
"0","  summarize(Average_Thread_Relevancy = mean(Thread_Relevancy, na.rm = TRUE))"
"0",""
"0","# Combine comment and thread summaries"
"0","keywords_summary_df <- keywords_summary_df %>%"
"0","  left_join(threads_summary_df_grouped, by = ""newsgroup"")"
"0",""
"0","total_unique_authors <- n_distinct(comments_in_keyword_threads$Author)"
"0",""
"0","# Add a totals row"
"0","totals <- keywords_summary_df %>%"
"0","  summarize("
"0","    newsgroup = ""Total"","
"0","    Comments_with_Keywords = sum(Comments_with_Keywords),"
"0","    Conversations_Mentioned_In = sum(Conversations_Mentioned_In),"
"0","    Total_Comments_In_Threads = sum(Total_Comments_In_Threads),"
"0","    Unique_Authors = total_unique_authors,"
"0","    Percent_Total_Comments_w_Keyword = (Comments_with_Keywords / Total_Comments_In_Threads) * 100,"
"0","    Average_Relevancy_Score = mean(Average_Relevancy_Score, na.rm = TRUE),"
"0","    Average_Thread_Relevancy = mean(Average_Thread_Relevancy, na.rm = TRUE)"
"0","  )"
"0",""
"0","# Combine the summary with the totals row"
"0","keywords_summary_df <- bind_rows(keywords_summary_df, totals)"
"0",""
"0","# Print the keyword summary data frame with totals"
"0","tab_df(keywords_summary_df, file = paste0(output_directory, ""images and tables/table_descriptive_statistics_aids.html""))"
