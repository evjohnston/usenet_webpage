"0","# Create top_authors list for the top 15 authors by influence"
"0","top_authors <- metadata %>%"
"0","  arrange(desc(influence)) %>%"
"0","  slice(1:20) %>%"
"0","  pull(Author)"
"0",""
"0","# Filter metadata and comments data for only top authors"
"0","metadata <- metadata %>%"
"0","  filter(Author %in% top_authors)"
"0",""
"0","comments_per_newsgroup_wide <- comments_per_newsgroup_wide %>%"
"0","  filter(Author %in% top_authors)"
"0",""
"0","# Step 10: Create Edges and Nodes for the visualization"
"0",""
"0","# Filter edges to include only those involving top authors"
"0","edges <- edges %>%"
"0","  filter(source %in% top_authors & target %in% top_authors)"
"0",""
"0","# Prepare nodes data"
"0","nodes <- data.frame("
"0","  name = top_authors,"
"0","  size = author_influence$influence[match(top_authors, author_influence$Author)],"
"0","  label = top_authors"
"0",")"
"0",""
"0","# Merge nodes with their community data"
"0","nodes <- nodes %>%"
"0","  left_join(node_communities, by = ""name"")"
"0",""
"0","# Add metadata and newsgroup comments in descending order to the title"
"0","nodes <- nodes %>%"
"0","  mutate("
"0","    # Calculate the newsgroup comments section dynamically"
"0","    comments_per_newsgroup = sapply(name, function(author_name) {"
"0","      author_data <- comments_per_newsgroup_wide %>%"
"0","        filter(Author == author_name) %>%"
"0","        select(-Author) %>%"
"0","        pivot_longer(cols = everything(), names_to = ""newsgroup"", values_to = ""comments"") %>%"
"0","        arrange(desc(comments))"
"0","      "
"0","      paste(author_data$newsgroup, author_data$comments, sep = "": "", collapse = ""<br>"")"
"0","    }),"
"0","    "
"0","    # Prepare the title with the formatted metadata and comments per newsgroup"
"0","    title = paste0("
"0","      ""<div style='background-color: #f2f2f2; border: 2px solid #666666; padding: 5px;'>"",  # Custom tooltip styling"
"0","      ""<strong>"", name, ""</strong><br>"","
"0","      ""Total Threads Participated: "", metadata$total_threads[match(name, metadata$Author)], ""<br>"","
"0","      ""Total Comments: "", metadata$total_comments[match(name, metadata$Author)], ""<br>"","
"0","      ""Threads Started: "", metadata$threads_started[match(name, metadata$Author)], ""<br>"","
"0","      ""Influence: "", metadata$influence[match(name, metadata$Author)], "" (based on the number of connections)"", ""<br><br>"","
"0","      ""<strong>Comments per Newsgroup</strong><br>"","
"0","      comments_per_newsgroup,"
"0","      ""</div>""  # End of custom tooltip styling"
"0","    )"
"0","  )"
"0",""
"0","# Identify current min and max sizes for nodes"
"0","current_min <- min(nodes$size, na.rm = TRUE)"
"0","current_max <- max(nodes$size, na.rm = TRUE)"
"0",""
"0","# Define new desired range for node sizes"
"0","new_min <- 15  # Minimum size"
"0","new_max <- 30  # Maximum size"
"0",""
"0","# Apply Min-Max scaling to the 'size' column"
"0","nodes <- nodes %>%"
"0","  mutate("
"0","    size = ((size - current_min) / (current_max - current_min)) * (new_max - new_min) + new_min"
"0","  )"
"0",""
"0","nodes"
